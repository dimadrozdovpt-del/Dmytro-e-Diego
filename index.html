<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ì–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç</title>
</head>
<body>

<button onclick="startRecognition()">üé§ –ì–æ–≤–æ—Ä–∏</button>
<p id="result">–°–∫–∞–∂–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å</p>

<script>
let userName = null;
let assistantName = "IA";

// ===== –†–ê–°–ü–û–ó–ù–ê–í–ê–ù–ò–ï –†–ï–ß–ò =====
const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

const recognition = new SpeechRecognition();
recognition.lang = "ru-RU";
recognition.interimResults = false;

// ===== –°–¢–ê–†–¢ =====
function startRecognition() {
  recognition.start();
}

// ===== –†–ï–ó–£–õ–¨–¢–ê–¢ –†–ï–ß–ò =====
recognition.onresult = (event) => {
  const text = event.results[0][0].transcript.toLowerCase();
  document.getElementById("result").innerText = text;
  handleSpeech(text);
};

// ===== –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–Ø –ú–ê–¢–ï–ú–ê–¢–ò–ö–ò =====
function normalizeMath(text) {
  return text
    .replace(/—Å–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç/gi, "")
    .replace(/–ø–ª—é—Å/gi, "+")
    .replace(/–º–∏–Ω—É—Å/gi, "-")
    .replace(/—É–º–Ω–æ–∂–∏—Ç—å –Ω–∞/gi, "*")
    .replace(/—É–º–Ω–æ–∂–∏—Ç—å/gi, "*")
    .replace(/–ø–æ–º–Ω–æ–∂–∏—Ç—å –Ω–∞/gi, "*")
    .replace(/–ø–æ–º–Ω–æ–∂–∏—Ç—å/gi, "*")
    .replace(/–∏–∫—Å/gi, "*")
    .replace(/—Ö/gi, "*")      // —Ä—É—Å—Å–∫–∞—è –•
    .replace(/√ó/g, "*")
    .replace(/—Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞/gi, "/")
    .replace(/—Ä–∞–∑–¥–µ–ª–∏—Ç—å/gi, "/")
    .replace(/√∑/g, "/")
    .replace(/[^0-9+\-*/().]/g, "")
    .trim();
}

// ===== –õ–û–ì–ò–ö–ê =====
function handleSpeech(text) {

  // === –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† ===
  if (text.includes("—Å–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç")) {
    try {
      const expression = normalizeMath(text);
      if (!expression) {
        speak("–Ø –Ω–µ –ø–æ–Ω—è–ª –ø—Ä–∏–º–µ—Ä");
        return;
      }
      const result = eval(expression);
      speak(`–ë—É–¥–µ—Ç ${result}`);
    } catch {
      speak("–û—à–∏–±–∫–∞ –≤ –ø—Ä–∏–º–µ—Ä–µ");
    }
    return;
  }

  // === –ó–ù–ê–ö–û–ú–°–¢–í–û ===
  if (!userName) {
    if (text.includes("–º–µ–Ω—è –∑–æ–≤—É—Ç")) {
      userName = text.replace("–º–µ–Ω—è –∑–æ–≤—É—Ç", "").trim();
      speak(`–ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è, ${userName}! –ú–µ–Ω—è –∑–æ–≤—É—Ç ${assistantName}.`);
    } else {
      speak("–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç? –°–∫–∞–∂–∏: –º–µ–Ω—è –∑–æ–≤—É—Ç...");
    }
    return;
  }

  // === –î–ò–ê–õ–û–ì–ò ===
  if (text.includes("–ø—Ä–∏–≤–µ—Ç")) {
    speak(`–ü—Ä–∏–≤–µ—Ç, ${userName}!`);
    return;
  }

  if (text.includes("–∫–∞–∫ –¥–µ–ª–∞")) {
    speak(`–£ –º–µ–Ω—è –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ, ${userName}!`);
    return;
  }

  if (text.includes("–∫–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç")) {
    speak(`–ú–µ–Ω—è –∑–æ–≤—É—Ç ${assistantName}`);
    return;
  }

  if (text.includes("—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å")) {
    speak("–Ø —É–º–µ—é —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å –∏ —Å—á–∏—Ç–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã");
    return;
  }

  speak(`${userName}, —è —Ç–µ–±—è –Ω–µ –ø–æ–Ω—è–ª.`);
}

// ===== –ì–û–õ–û–° =====
function speak(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = "ru-RU";
  speechSynthesis.speak(utterance);
}
</script>

</body>
</html>
