<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ì–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç</title>
</head>
<body>

<button onclick="startRecognition()">üé§ –ì–æ–≤–æ—Ä–∏</button>
<p id="result">–°–∫–∞–∂–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å</p>

<script>
let userName = null;
let assistantName = "IA";

const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

const recognition = new SpeechRecognition();
recognition.lang = "ru-RU";
recognition.interimResults = false;

function startRecognition() {
  recognition.start();
}

recognition.onresult = (event) => {
  const text = event.results[0][0].transcript.toLowerCase();
  document.getElementById("result").innerText = text;
  handleSpeech(text);
};

function handleSpeech(text) {

  // ===== –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† (eval) =====
  if (text.includes("—Å–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç")) {
    try {
      let expression = text
        .replace("—Å–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç", "")
        .replace("–ø–ª—é—Å", "+")
        .replace("–º–∏–Ω—É—Å", "-")
        .replace("—É–º–Ω–æ–∂–∏—Ç—å –Ω–∞", "*")
        .replace("—É–º–Ω–æ–∂–∏—Ç—å", "*")
        .replace("—Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞", "/")
        .replace("—Ä–∞–∑–¥–µ–ª–∏—Ç—å", "/")
        .replace(/[^0-9+\-*/(). ]/g, "")
        .trim();

      const result = eval(expression);
      speak(`–ë—É–¥–µ—Ç ${result}`);
    } catch (e) {
      speak("–û—à–∏–±–∫–∞ –≤ –ø—Ä–∏–º–µ—Ä–µ");
    }
    return;
  }

  // ===== –ó–ù–ê–ö–û–ú–°–¢–í–û =====
  if (!userName) {
    if (text.includes("–º–µ–Ω—è –∑–æ–≤—É—Ç")) {
      userName = text.replace("–º–µ–Ω—è –∑–æ–≤—É—Ç", "").trim();
      speak(`–ü—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è, ${userName}! –ú–µ–Ω—è –∑–æ–≤—É—Ç ${assistantName}.`);
    } else {
      speak("–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç? –°–∫–∞–∂–∏: –º–µ–Ω—è –∑–æ–≤—É—Ç...");
    }
    return;
  }

  // ===== –î–ò–ê–õ–û–ì–ò =====
  const dialogs = [
    {
      keywords: ["–ø—Ä–∏–≤–µ—Ç"],
      answer: `–ü—Ä–∏–≤–µ—Ç, ${userName}!`
    },
    {
      keywords: ["–∫–∞–∫ –¥–µ–ª–∞"],
      answer: `–£ –º–µ–Ω—è –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ, ${userName}!`
    },
    {
      keywords: ["–∫–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç"],
      answer: `–ú–µ–Ω—è –∑–æ–≤—É—Ç ${assistantName}`
    },
    {
      keywords: ["—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å"],
      answer: `–Ø —É–º–µ—é —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å –∏ —Å—á–∏—Ç–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã`
    }
  ];

  for (let dialog of dialogs) {
    for (let key of dialog.keywords) {
      if (text.includes(key)) {
        speak(dialog.answer);
        return;
      }
    }
  }

  speak(`${userName}, —è —Ç–µ–±—è –Ω–µ –ø–æ–Ω—è–ª.`);
}

function speak(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = "ru-RU";
  speechSynthesis.speak(utterance);
}
</script>

</body>
</html>
